<h2 class="text-3xl font-bold text-center mb-8 text-red-600">Browse Menu</h2>

<!-- Main Category Tabs -->
<div class="flex flex-wrap justify-center gap-4 mb-8">
  <% @main_categories.each do |cat| %>
    <%= link_to cat.name, foods_path(category_id: cat.slug), class: "px-4 py-2 rounded-full font-semibold border border-red-600 transition hover:bg-red-600 hover:text-white #{'bg-red-600 text-white' if @selected_category == cat}" %>
  <% end %>
</div>

<!-- Subcategory Tabs (only for Food) -->
<% if @selected_category&.name == "Food" && @food_subcategories.any? %>
  <div class="flex flex-wrap justify-center gap-3 mb-8">
    <% @food_subcategories.each do |sub| %>
      <%= link_to sub.name, foods_path(category_id: @selected_category.id, sub_category: sub.name), 
          class: "px-4 py-2 rounded-full font-semibold transition #{'bg-red-600 text-white' if sub == @selected_subcategory} hover:bg-red-500 hover:text-white" %>
    <% end %>
  </div>
<% end %>

<!-- Food Grid -->
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
  <% if @foods.any? %>
    <% @foods.each do |food| %>
      <div class="bg-white rounded-2xl shadow-md hover:shadow-xl transition overflow-hidden flex flex-col">
        
        <!-- Food Image -->
        <%= link_to food_path(food), class: "flex-1" do %>
          <% if food.image.attached? %>
            <%= image_tag food.image, class: "w-full h-48 object-cover transition-transform duration-300 hover:scale-105" %>
          <% else %>
            <img src="/images/default-food.jpg" alt="<%= food.name %>" class="w-full h-48 object-cover rounded-t-2xl">
          <% end %>

          <!-- Food Info -->
          <div class="p-4">
            <h3 class="text-lg font-bold text-red-600 mb-1"><%= food.name %></h3>
            <p class="text-gray-600 mb-2 line-clamp-3"><%= food.description %></p>
            <p class="font-semibold text-gray-800 mb-2">₦<%= number_to_currency(food.price, unit: "", precision: 0) %></p>

            <!-- Reviews -->
            <% if food.reviews.any? %>
              <p class="text-sm text-gray-700 mb-1">
                ⭐ <%= number_with_precision(food.reviews.average(:rating), precision: 1) %> • <%= pluralize(food.reviews.count, "review") %>
              </p>
              <%= link_to "Read all reviews", food_path(food, anchor: "reviews"), class: "text-sm text-red-600 hover:underline" %>
            <% else %>
              <p class="text-sm text-gray-400 mb-1">No reviews yet</p>
            <% end %>
          </div>
        <% end %>

        <!-- Add to Cart -->
        <div class="p-4 border-t border-gray-100">
          <%= form_with url: cart_items_path, method: :post, local: true, class: "flex items-center gap-2" do |f| %>
            <%= hidden_field_tag :food_id, food.id %>
            <%= number_field_tag :quantity, 1, min: 1, class: "w-16 border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-red-500" %>
            <%= f.submit "Add to Cart", class: "bg-red-600 text-white px-4 py-2 rounded-full font-semibold hover:bg-red-500 transition" %>
          <% end %>
        </div>
      </div>
    <% end %>
  <% else %>
    <p class="col-span-4 text-center text-gray-500 text-lg">No items available in this category.</p>
  <% end %>
</div>
