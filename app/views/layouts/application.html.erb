<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Food App" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%= stylesheet_link_tag "tailwind.css", "data-turbo-track": "reload" %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="apple-touch-icon" href="/icon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">

    <%= javascript_importmap_tags %>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  </head>

  <body class="bg-gray-50 text-gray-800 font-sans">
    <!-- HEADER -->
    <header class="bg-[#F97316] text-white shadow sticky top-0 z-50">
      <div class="max-w-6xl mx-auto flex items-center justify-between px-4 h-20 relative">

        <!-- Logo -->
        <%= link_to root_path, class: "text-3xl font-extrabold tracking-wide text-white" do %>
          FoodApp
        <% end %>

        <!-- Desktop Navigation -->
        <nav class="hidden lg:flex gap-6 items-center">
          <%= link_to "Home", (current_user&.admin? ? admin_dashboard_path : root_path),
              class: "hover:text-[#FACC15] font-medium transition-colors" %>

          <%= link_to "Browse Menu", public_foods_path,
               class: "hover:text-[#FACC15] font-bold transition-colors" %>

          <% if user_signed_in? %>
            <% if current_user.is_a?(User) %>
              <%= link_to "My Orders", orders_path,
                  class: "hover:text-[#FACC15] font-medium transition-colors" %>

              <%= link_to "My Conversations#{@unread_conversations_count.positive? ? " (#{@unread_conversations_count})" : ""}".html_safe,
                users_conversations_path, class: "hover:text-[#FACC15] font-medium transition-colors" %>

              <%= link_to "Support Tickets#{@new_support_tickets_count.positive? ? " (#{@new_support_tickets_count})" : ""}".html_safe,
                  support_tickets_path, class: "hover:text-[#FACC15] font-medium transition-colors" %>

            <% elsif current_user.is_a?(Vendor) %>
              <%= link_to "Conversations#{@unread_conversations_count.positive? ? " (#{@unread_conversations_count})" : ""}".html_safe,
                  vendor_conversations_path, class: "hover:text-[#FACC15] font-medium transition-colors" %>

            <% elsif current_user.admin? %>
              <%= link_to "Admin Dashboard", admin_dashboard_path,
                  class: "hover:text-[#FACC15] font-medium transition-colors" %>
            <% end %>

            <%= button_to "Logout", destroy_user_session_path, method: :delete,
                form_class: "inline", class: "hover:text-[#FACC15] font-medium transition-colors" %>

          <% else %>
            <%= link_to "Login", new_user_session_path,
                class: "hover:text-[#FACC15] font-medium transition-colors" %>
            <%= link_to "Sign Up", new_user_registration_path,
                class: "hover:text-[#FACC15] font-medium transition-colors" %>
            <%= link_to new_vendor_session_path, class: "flex items-center gap-1 hover:text-yellow-300 font-medium transition-colors" do %>
              <i class="fas fa-store"></i> Login as Vendor
            <% end %>
          <% end %>

          <%= link_to "Become a Vendor", new_vendor_registration_path,
              class: "hover:text-[#FACC15] font-medium transition-colors" %>

          <% if current_cart.present? && current_cart.cart_items.any? %>
            <%= link_to cart_path, class: "relative hover:text-[#FACC15] transition-colors" do %>
              <i class="fas fa-shopping-cart text-lg"></i>
              <span class="absolute -top-2 -right-3 bg-white text-[#F97316] text-xs font-bold rounded-full px-2 py-0.5">
                <%= current_cart.cart_items.sum(:quantity) %>
              </span>
            <% end %>
          <% end %>
        </nav>

        <!-- Hamburger for Mobile -->
        <button id="hamburger-btn" class="lg:hidden text-white text-2xl relative z-50">
          <i class="fas fa-bars"></i>
        </button>

        <!-- Mobile Menu -->
               <!-- Mobile Menu -->
        <nav id="mobile-nav"
          class="hidden absolute top-full right-0 left-0 bg-white shadow-lg z-60 flex flex-col gap-1 p-4 rounded-b-md transition-all duration-300 transform -translate-y-5 opacity-0">

          <%= link_to "Home", (current_user&.admin? ? admin_dashboard_path : root_path),
              class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>

          <%= link_to "Browse Menu", public_foods_path,
              class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-bold rounded transition-colors" %>

          <% if user_signed_in? %>
            <span class="block px-4 py-2 text-gray-500 text-sm">
              Logged in as <%= current_user.email %>
            </span>

            <% if current_user.is_a?(User) %>
              <%= link_to "My Orders", orders_path,
                  class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>

              <%= link_to "My Conversations#{@unread_conversations_count.positive? ? " (#{@unread_conversations_count})" : ""}".html_safe,
                  users_conversations_path, class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>

              <%= link_to "Support Tickets#{@new_support_tickets_count.positive? ? " (#{@new_support_tickets_count})" : ""}".html_safe,
                  support_tickets_path, class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>

            <% elsif current_user.is_a?(Vendor) %>
              <%= link_to "Conversations#{@unread_conversations_count.positive? ? " (#{@unread_conversations_count})" : ""}".html_safe,
                  vendor_conversations_path, class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>

            <% elsif current_user.admin? %>
              <%= link_to "Admin Dashboard", admin_dashboard_path,
                  class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>
            <% end %>

            <%= button_to "Logout", destroy_user_session_path, method: :delete,
                form_class: "block w-full text-left",
                class: "px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>

          <% else %>
            <%= link_to "Login", new_user_session_path,
                class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>
            <%= link_to "Sign Up", new_user_registration_path,
                class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>
            <%= link_to new_vendor_session_path, class: "flex items-center gap-1 px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-yellow-400 font-medium rounded transition-colors" do %>
              <i class="fas fa-store"></i> Login as Vendor
            <% end %>
          <% end %>

          <%= link_to "Become a Vendor", new_vendor_registration_path,
              class: "block px-4 py-2 text-[#F97316] hover:bg-[#FFF3E0] hover:text-[#FACC15] font-medium rounded transition-colors" %>

          <% if current_cart.present? && current_cart.cart_items.any? %>
            <%= link_to cart_path, class: "relative block px-4 py-2 text-[#FACC15] hover:text-[#F97316] transition-colors" do %>
              <i class="fas fa-shopping-cart text-lg"></i>
              <span class="absolute -top-2 -right-3 bg-white text-[#F97316] text-xs font-bold rounded-full px-2 py-0.5">
                <%= current_cart.cart_items.sum(:quantity) %>
              </span>
            <% end %>
          <% end %>
        </nav>

      </div>
    </header>

    <!-- Hamburger Script -->
    <script>
      const btn = document.getElementById('hamburger-btn');
      const nav = document.getElementById('mobile-nav');

      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const icon = btn.querySelector('i');
        nav.classList.toggle('hidden');
        if (!nav.classList.contains('hidden')) {
          nav.classList.remove('-translate-y-5', 'opacity-0');
          nav.classList.add('translate-y-0', 'opacity-100');
          icon.classList.remove('fa-bars');
          icon.classList.add('fa-times');
        } else {
          nav.classList.add('-translate-y-5', 'opacity-0');
          nav.classList.remove('translate-y-0', 'opacity-100');
          icon.classList.remove('fa-times');
          icon.classList.add('fa-bars');
        }
      });

      document.addEventListener('click', (e) => {
        if (!btn.contains(e.target) && !nav.contains(e.target)) {
          if (!nav.classList.contains('hidden')) {
            nav.classList.add('-translate-y-5', 'opacity-0');
            nav.classList.remove('translate-y-0', 'opacity-100');
            setTimeout(() => nav.classList.add('hidden'), 300);
            btn.querySelector('i').classList.remove('fa-times');
            btn.querySelector('i').classList.add('fa-bars');
          }
        }
      });
    </script>

    <!-- FLASH -->
    <div id="flash-container" class="fixed top-16 left-1/2 -translate-x-1/2 z-50 space-y-2 w-full max-w-md">
      <% flash.each do |type, message| %>
        <% css_class = case type.to_sym
                      when :notice then "bg-green-500"
                      when :alert then "bg-red-500"
                      when :error then "bg-red-600"
                      when :warning then "bg-yellow-500"
                      else "bg-blue-500"
                      end %>
        <div class="p-4 rounded-md text-center font-bold text-white shadow-lg animate-fade-in-out <%= css_class %>">
          <%= message %>
        </div>
      <% end %>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const flashContainer = document.getElementById("flash-container");
        if (flashContainer) {
          setTimeout(() => {
            flashContainer.style.transition = "opacity 0.5s";
            flashContainer.style.opacity = "0";
            setTimeout(() => flashContainer.remove(), 500);
          }, 4000);
        }
      });
    </script>

    <style>
      @keyframes fade-in-out {
        0% { opacity: 0; transform: translateY(-10px); }
        10% { opacity: 1; transform: translateY(0); }
        90% { opacity: 1; transform: translateY(0); }
        100% { opacity: 0; transform: translateY(-10px); }
      }
      .animate-fade-in-out {
        animation: fade-in-out 4s ease forwards;
      }
    </style>

    <!-- MAIN CONTENT -->
    <%= yield %>








  </body>
</html>
