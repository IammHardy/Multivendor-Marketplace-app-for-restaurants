<%= form_with(model: [:vendor, @promotion], local: true, html: { class: "max-w-3xl mx-auto bg-white shadow-md rounded-2xl p-8 space-y-6" }) do |f| %>
  <h2 class="text-2xl font-bold text-gray-800">
    <%= @promotion.new_record? ? "Create New Promotion" : "Edit Promotion" %>
  </h2>

  <!-- Title -->
  <div>
    <%= f.label :title, "Promotion Title", class: "block font-semibold text-gray-700 mb-1" %>
    <%= f.text_field :title, class: "w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-orange-400" %>
  </div>

  <!-- Description -->
  <div>
    <%= f.label :description, "Description", class: "block font-semibold text-gray-700 mb-1" %>
    <%= f.text_area :description, rows: 3, class: "w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-orange-400" %>
  </div>

  <!-- Food Selection -->
  <div>
    <%= f.label :food_id, "Link a Food (optional)", class: "block font-semibold text-gray-700 mb-1" %>
    <%= f.collection_select :food_id, current_vendor.foods, :id, :name,
          { include_blank: "Select a food" },
          class: "w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-orange-400" %>
  </div>

  <!-- Image Upload with Preview -->
  <div>
    <%= f.label :image, "Promotion Image", class: "block font-semibold text-gray-700 mb-2" %>
    <div class="flex items-center gap-4">
      <% if @promotion.image.attached? %>
        <%= image_tag @promotion.image.variant(resize_to_limit: [150, 150]), class: "w-24 h-24 object-cover rounded-lg shadow" %>
      <% else %>
        <div id="image-preview" class="w-24 h-24 flex items-center justify-center border border-gray-300 rounded-lg text-gray-400 text-sm">
          No image
        </div>
      <% end %>
      <%= f.file_field :image, accept: "image/*", class: "text-sm text-gray-700" %>
    </div>
  </div>

  <!-- CTA Text and URL -->
  <div class="grid md:grid-cols-2 gap-4">
    <div>
      <%= f.label :cta_text, "Button Text", class: "block font-semibold text-gray-700 mb-1" %>
      <%= f.text_field :cta_text, class: "w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-orange-400" %>
    </div>

    <div class="mb-4">
  <%= f.label :cta_url, "Button Link URL", class: "block text-gray-700 font-medium mb-2" %>
  <%= f.text_field :cta_url,
        value: @promotion.cta_url,
        placeholder: "e.g. /vendor/menu or https://yourshop.com/special-offer",
        class: "border rounded px-3 py-2 w-full" %>
  <small class="text-gray-500">
    Customers will be taken to this page when they click your promotion button.
  </small>
</div>


  </div>

  <!-- Start & End Dates -->
  <div class="grid md:grid-cols-2 gap-4">
    <div>
      <%= f.label :starts_at, "Starts At", class: "block font-semibold text-gray-700 mb-1" %>
      <%= f.datetime_local_field :starts_at, class: "w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-orange-400" %>
    </div>

    <div>
      <%= f.label :ends_at, "Ends At", class: "block font-semibold text-gray-700 mb-1" %>
      <%= f.datetime_local_field :ends_at, class: "w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-orange-400" %>
    </div>
  </div>

  <!-- Active Toggle -->
  <div class="flex items-center gap-2">
    <%= f.check_box :active, class: "h-5 w-5 text-orange-500 focus:ring-orange-400 border-gray-300 rounded" %>
    <%= f.label :active, "Mark as Active", class: "font-medium text-gray-700" %>
  </div>

  <!-- Submit Button -->
  <div class="text-center pt-4">
    <%= f.submit (@promotion.new_record? ? "Create Promotion" : "Update Promotion"),
        class: "bg-orange-500 hover:bg-orange-600 text-white font-medium px-6 py-2 rounded-lg transition" %>
  </div>
<% end %>

<!-- Preview Script -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const fileInput = document.querySelector('input[type="file"][name="promotion[image]"]');
    const preview = document.querySelector('#image-preview');

    if (fileInput && preview) {
      fileInput.addEventListener('change', e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = ev => {
          preview.innerHTML = `<img src="${ev.target.result}" class="w-24 h-24 object-cover rounded-lg shadow" />`;
        };
        reader.readAsDataURL(file);
      });
    }
  });
</script>
