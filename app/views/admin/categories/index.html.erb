<h1>Food Categories</h1>

<div style="margin-bottom: 20px;">
  <%= link_to "➕ Add Category", new_admin_category_path, class: "btn btn-primary" %>
  <%= link_to "➕ Add Food", new_admin_food_path, class: "btn btn-success", style: "margin-left: 10px;" %>
</div>

<%= form_with url: admin_categories_path, method: :get, local: true do |form| %>
  <div style="margin-bottom: 20px;">
    <%= form.label :search, "Search Categories or Foods" %><br>
    <%= form.text_field :search, value: params[:search], placeholder: "Type to search...", class: "form-control", style: "max-width: 300px;" %>
    <%= form.submit "Search", class: "btn btn-secondary", style: "margin-top: 10px;" %>
    <% if params[:search].present? %>
      <%= link_to "Clear Search", admin_categories_path, class: "btn btn-warning", style: "margin-left: 10px;" %>
    <% end %>
  </div>
<% end %>

<% @categories.where(parent_id: nil).each do |parent| %>
  <div class="order-card">
    <h2><%= parent.name %></h2>

    <!-- Edit/Delete parent -->
    <div style="margin-bottom: 10px;">
      <%= link_to "Edit", edit_admin_category_path(parent), class: "btn btn-sm btn-primary" %>
      <%= button_to "Delete", admin_category_path(parent), method: :delete, data: { confirm: "Are you sure you want to delete this category?" }, class: "btn btn-sm btn-danger" unless parent.children.any? || parent.foods.any? %>
      <% if parent.children.any? || parent.foods.any? %>
        <span style="font-size: 13px; color: red;">(Delete disabled - has subcategories or foods)</span>
      <% end %>
    </div>

    <% if parent.children.any? %>
      <div style="padding-left: 20px;">
        <h4>Subcategories:</h4>
        <% parent.children.each do |child| %>
          <strong><%= child.name %></strong>
          <%= link_to "Edit", edit_admin_category_path(child), class: "btn btn-xs btn-outline-primary" %>
          <%= button_to "Delete", admin_category_path(child), method: :delete, data: { confirm: "Delete subcategory?" }, class: "btn btn-xs btn-outline-danger" unless child.foods.any? %>
          <% if child.foods.any? %>
            <span style="color: red;">(Has foods)</span>
          <% end %>
          <br><br>
        <% end %>
      </div>
    <% end %>

    <% if parent.foods.any? %>
      <h4 style="margin-top: 15px;">Foods:</h4>
      <ul>
        <% parent.foods.each do |food| %>
          <li>
            <%= food.name %> -
            <%= link_to "Edit", edit_admin_food_path(food), class: "btn btn-sm btn-primary" %>
            <%= button_to "Delete", admin_food_path(food), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-sm btn-danger" %>
          </li>
        <% end %>
      </ul>
    <% end %>
  </div>
<% end %>

<%= link_to "← Back to Admin Dashboard", root_path, class: "btn btn-secondary", style: "margin-top: 20px;" %>


<style>
  .order-card {
    background-color: #f8f9fa;
    border: 1px solid #ddd;
    padding: 15px;
    margin-bottom: 25px;
    border-radius: 5px;
  }

  .btn-sm {
    margin-left: 5px;
    margin-top: 5px;
  }
</style>
