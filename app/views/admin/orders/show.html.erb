<div class="max-w-4xl mx-auto mt-10 p-8 bg-white rounded-2xl shadow-lg">
  <h1 class="text-3xl font-extrabold text-[#F97316] mb-8">Order Details: #<%= @order.id %></h1>

  <!-- Customer Info -->
  <div class="mb-8 p-6 bg-gray-50 rounded-xl shadow-sm">
    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Customer Information</h2>
    <p><strong class="text-gray-600">Name:</strong> <span class="font-medium text-gray-800"><%= @order.user&.name || "N/A" %></span></p>
    <p><strong class="text-gray-600">Email:</strong> <span class="font-medium text-gray-800"><%= @order.user&.email || "N/A" %></span></p>
  </div>

  <!-- Vendors Info -->
  <div class="mb-8 p-6 bg-gray-50 rounded-xl shadow-sm">
    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Vendor(s)</h2>
    <% vendors = @order.order_items.includes(food: :vendor).map { |item| item.food.vendor }.uniq.compact %>
    <% if vendors.any? %>
      <ul class="list-disc list-inside space-y-1 text-gray-800">
        <% vendors.each do |vendor| %>
          <li><%= vendor.name %></li>
        <% end %>
      </ul>
    <% else %>
      <p class="text-gray-500">N/A</p>
    <% end %>
  </div>

  <!-- Order Items -->
  <div class="mb-8 p-6 bg-gray-50 rounded-xl shadow-sm">
    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Order Items</h2>
    <% if @order.order_items.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded-lg overflow-hidden">
          <thead class="bg-gray-100 text-gray-700 text-sm uppercase">
            <tr>
              <th class="px-4 py-3 text-left">Food</th>
              <th class="px-4 py-3 text-left">Vendor</th>
              <th class="px-4 py-3 text-left">Quantity</th>
              <th class="px-4 py-3 text-left">Price</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            <% @order.order_items.includes(food: :vendor).each do |item| %>
              <tr>
                <td class="px-4 py-3 font-medium text-gray-800"><%= item.food&.name || "N/A" %></td>
                <td class="px-4 py-3 text-gray-700"><%= item.food&.vendor&.name || "N/A" %></td>
                <td class="px-4 py-3 text-gray-700"><%= item.quantity %></td>
                <td class="px-4 py-3 font-semibold text-[#F97316]">₦<%= item.price || item.food&.price || 0 %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-gray-500">No items in this order.</p>
    <% end %>
  </div>

  <!-- Order Summary -->
  <div class="mb-8 p-6 bg-gray-50 rounded-xl shadow-sm">
    <h2 class="text-2xl font-semibold text-gray-700 mb-4">Summary</h2>
    <p><strong class="text-gray-600">Total Price:</strong> <span class="font-bold text-[#F97316]">₦<%= @order.total_price || 0 %></span></p>
    <p><strong class="text-gray-600">Status:</strong> 
      <% status_color = case @order.status
                        when "completed" then "bg-[#FACC15] text-gray-800"
                        when "pending" then "bg-gray-200 text-gray-800"
                        when "cancelled" then "bg-red-200 text-red-800"
                        else "bg-gray-200 text-gray-800"
                        end %>
      <span class="px-2 py-1 rounded-full font-semibold <%= status_color %>"><%= @order.status || "N/A" %></span>
    </p>
  </div>

  <div class="flex justify-start">
    <%= link_to "Back to Orders", admin_orders_path, class: "px-6 py-3 bg-[#F97316] rounded-full hover:bg-[#E65C00] font-medium text-white shadow transition" %>
  </div>

  <div id="map" style="height: 400px;"></div>

<script>
  const orderId = <%= @order.id %>;
  const map = L.map('map').setView([0, 0], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  const riderMarker = L.marker([0,0]).addTo(map);

  App.cable.subscriptions.create({ channel: "OrderStatusChannel", order_id: orderId }, {
    received(data) {
      if (data.rider_latitude && data.rider_longitude) {
        const latLng = [data.rider_latitude, data.rider_longitude];
        riderMarker.setLatLng(latLng);
        map.setView(latLng);
      }
      console.log("Rider status update:", data);
    }
  });
</script>
</div>
