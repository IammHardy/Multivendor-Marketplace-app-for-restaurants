<main class="max-w-7xl mx-auto px-6 py-8">

  <!-- Back Link -->
  <div class="mb-6">
    <%= link_to "← Back to Browse Menu", 
                public_foods_path(category_id: @food.categories.first&.slug), 
                class: "inline-block text-orange-500 font-semibold hover:underline" %>
  </div>

  <!-- Food + Vendor Info -->
  <div class="flex flex-col md:flex-row gap-8 mb-12">

    <!-- Food Image -->
    <div class="md:w-1/2">
      <% if @food.image.attached? %>
        <%= image_tag @food.image, class: "w-full h-96 object-cover rounded-2xl shadow-lg hover:scale-105 transition-transform duration-300" %>
      <% else %>
        <img src="/images/default-food.jpg" class="w-full h-96 object-cover rounded-2xl shadow-lg">
      <% end %>
    </div>

    <!-- Food Info + Vendor -->
    <div class="md:w-1/2 flex flex-col justify-between">
      <div class="space-y-4">
        <h1 class="text-3xl font-extrabold text-orange-500"><%= @food.name %></h1>
        <p class="text-gray-700"><%= @food.description %></p>
        <p class="text-2xl font-semibold text-gray-800">₦<%= number_to_currency(@food.price, unit: "", precision: 0) %></p>

        <!-- Vendor Badge -->
        <p>
          Vendor: 
          <%= link_to @vendor.name, public_vendor_path(@vendor), class: "text-yellow-500 font-semibold hover:underline" %>
        </p>


        <%= render "carts/cart_count" %>

        <!-- Add to Cart -->
       <%= form_with url: cart_items_path, method: :post, class: "flex items-center gap-3 mt-4" do |f| %>

          <%= hidden_field_tag :food_id, @food.id %>
          <%= number_field_tag :quantity, 1, min: 1, class: "w-20 text-center border rounded-full px-3 py-2" %>
          <%= f.submit "Add to Cart", class: "bg-orange-500 text-white px-5 py-2 rounded-full hover:bg-orange-600 transition" %>
          <%= f.submit "Proceed to Checkout", name: "commit_type", value: "Checkout", class: "bg-yellow-400 text-gray-900 px-5 py-2 rounded-full hover:bg-yellow-500 transition" %>
        <% end %>
      </div>
    </div>
    

  </div>

  <section class="bg-gradient-to-b from-orange-50 to-yellow-50 rounded-3xl shadow-lg p-8 mb-12">
  <h2 class="text-3xl font-extrabold text-[#F97316] mb-6 text-center">
    Customer Reviews
  </h2>

  <% if @food.reviews.any? %>
    <div class="space-y-6">
      <% @food.reviews.order(created_at: :desc).each do |review| %>
        <div class="bg-white rounded-2xl shadow-md p-6 hover:shadow-xl transition">
          <!-- Reviewer name + rating stars -->
          <div class="flex items-center justify-between mb-3">
            <span class="font-semibold text-gray-900 text-lg">
              <%= review.user&.name.presence || "Anonymous" %>
            </span>

            <!-- ⭐ Display rating as stars -->
            <div class="flex space-x-1">
              <% 5.times do |i| %>
                <% if review.rating >= i+1 %>
                  <i class="fas fa-star text-yellow-400"></i>
                <% else %>
                  <i class="far fa-star text-gray-300"></i>
                <% end %>
              <% end %>
            </div>
          </div>

          <!-- Comment -->
          <p class="text-gray-700 italic leading-relaxed">
            "<%= review.comment %>"
          </p>

          <!-- Date -->
          <p class="text-sm text-gray-400 mt-3">
            <%= review.created_at.strftime("%B %d, %Y") %>
          </p>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-center text-gray-500 italic">
      No reviews yet. Be the first to leave one!
    </p>
  <% end %>
</section>


  <!-- Reviews -->
<!-- Review Form -->
<div class="mt-6 bg-yellow-50 p-6 rounded-2xl shadow-md">
  <h3 class="text-xl font-semibold mb-4">Leave a Review</h3>

  <% if user_signed_in? %>
    <%= form_with model: [ :public, @food, Review.new ], url: public_food_reviews_path(@food), local: true do |f| %>
      
      <!-- Star Rating -->
      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-2">Your Rating</label>
        
        <!-- Hidden field to store rating -->
        <%= f.hidden_field :rating, id: "food_review_rating" %>

        <!-- Stars -->
        <div id="food-star-rating" class="flex space-x-1 cursor-pointer text-2xl text-gray-300">
          <% 5.times do |i| %>
            <i class="far fa-star" data-value="<%= i+1 %>"></i>
          <% end %>
        </div>
      </div>

      <!-- Comment -->
      <div class="mb-4">
        <%= f.label :comment, "Your Comment", class: "block text-sm font-medium text-gray-500 mb-2" %>
        <%= f.text_area :comment, rows: 4,
          class: "w-full rounded-3xl border border-gray-300 px-4 py-3 text-gray-700 focus:ring-2 focus:ring-orange-400 focus:border-orange-400 transition" %>
      </div>

      <!-- Submit -->
      <div class="text-center">
        <%= f.submit "Submit Review",
          class: "bg-[#F97316] hover:bg-orange-600 text-white font-semibold px-8 py-3 rounded-full shadow-md transition duration-300" %>
      </div>
    <% end %>
  <% else %>
    <p class="text-gray-500">You must be logged in to leave a review.</p>
  <% end %>
</div>

<!-- Animation Script -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const stars = document.querySelectorAll("#food-star-rating i");
  const ratingInput = document.getElementById("food_review_rating");

  stars.forEach(star => {
    star.addEventListener("click", () => {
      const value = star.getAttribute("data-value");
      ratingInput.value = value;

      // Highlight stars up to selected one
      stars.forEach(s => {
        if (s.getAttribute("data-value") <= value) {
          s.classList.remove("far");
          s.classList.add("fas", "text-yellow-400");
        } else {
          s.classList.remove("fas", "text-yellow-400");
          s.classList.add("far");
        }
      });
    });
  });
});
</script>



  <!-- Other Foods from Vendor -->
  <% if @other_foods_from_vendor.any? %>
    <div>
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Other Foods from <%= @vendor.name %></h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        <% @other_foods_from_vendor.each do |food| %>
          <%= render partial: "public/foods/food_card", locals: { food: food } %>
        <% end %>
      </div>
    </div>
  <% end %>
          



</main>
