<main class="bg-gray-50">

  <!-- Back Button -->
  <div class="max-w-7xl mx-auto px-6 py-4">
    <%= link_to "← Back to Vendors", vendors_path, class: "text-red-600 hover:underline font-semibold" %>
  </div>

  <!-- =====================
       HERO SECTION
  ====================== -->
  <section class="relative w-full h-64 sm:h-80 md:h-96 bg-gray-200 rounded-b-2xl overflow-hidden">
    <%# Banner Image %>
    <% if @vendor.banner_image.attached? %>
      <%= image_tag @vendor.banner_image, class: "w-full h-full object-cover" %>
    <% else %>
      <%= image_tag "default-vendor.jpg", class: "w-full h-full object-cover" %>
    <% end %>

    <div class="absolute inset-0 bg-black/30 flex items-center justify-center">
      <div class="text-center text-white px-4">

        <%# Profile Image %>
        <% if @vendor.profile_image.attached? %>
          <%= image_tag @vendor.profile_image, class: "w-24 h-24 rounded-full mx-auto border-4 border-white mb-4" %>
        <% else %>
          <%= image_tag "default-promo.jpg", class: "w-24 h-24 rounded-full mx-auto border-4 border-white mb-4" %>
        <% end %>

        <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold"><%= @vendor.name %></h1>
        <p class="mt-2 text-sm sm:text-base md:text-lg">
          <%= truncate(@vendor.bio.presence || "Delicious meals from #{@vendor.name}", length: 120) %>
        </p>

        <% if @average_rating.present? %>
          <div class="mt-2 flex justify-center items-center space-x-1">
            <% full_stars = @average_rating.floor %>
            <% half_star = (@average_rating - full_stars) >= 0.5 %>
            <% empty_stars = 5 - full_stars - (half_star ? 1 : 0) %>

            <% full_stars.times { %><span class="text-yellow-400 text-xl">★</span><% } %>
            <% if half_star %><span class="text-yellow-400 text-xl">★</span><% end %>
            <% empty_stars.times { %><span class="text-gray-300 text-xl">★</span><% } %>

            <span class="ml-2 text-white font-medium text-base">
              (<%= @reviews_count %> reviews)
            </span>
          </div>
        <% end %>

      </div>
    </div>
  </section>

  <!-- =====================
       ABOUT SECTION
  ====================== -->
  <section class="max-w-7xl mx-auto px-6 py-8 bg-white rounded-2xl shadow-md mt-8">
    <h2 class="text-2xl font-bold mb-4">About</h2>
    <p class="text-gray-700 mb-4"><%= @vendor.bio.presence || "No description available." %></p>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 text-gray-700">
      <div class="space-y-2">
        <p><strong>Location:</strong> <%= @vendor.city.presence || "Not specified" %></p>
        <p><strong>Business Type:</strong> <%= @vendor.business_type.presence || "Not specified" %></p>
        <% if @vendor.opening_hours.present? %>
          <p><strong>Opening Hours:</strong> <%= @vendor.opening_hours %></p>
        <% end %>
      </div>

      <div class="space-y-2">
        <% if @vendor.phone.present? %>
          <p><strong>Phone:</strong> <a href="tel:<%= @vendor.phone %>" class="text-red-600 hover:underline"><%= @vendor.phone %></a></p>
        <% end %>
        <% if @vendor.whatsapp.present? %>
          <p><strong>WhatsApp:</strong> <a href="https://wa.me/<%= @vendor.whatsapp %>" target="_blank" class="text-green-600 hover:underline"><%= @vendor.whatsapp %></a></p>
        <% end %>
      </div>
    </div>
  </section>

  <!-- =====================
       CATEGORY FILTER
  ====================== -->
  <div class="max-w-7xl mx-auto px-6 mt-6 flex flex-wrap gap-3">
    <%= link_to "All", vendor_path(@vendor), class: "px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300 transition duration-200" %>

    <% @categories.each do |category| %>
      <%= link_to category.name, vendor_path(@vendor, category_id: category.id), class: "px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300 transition duration-200" %>
    <% end %>
  </div>

 
<!-- =====================
     MENU SECTION
====================== -->
<section class="max-w-7xl mx-auto px-6 py-12">
  <h2 class="text-3xl font-bold text-red-600 mb-8 text-center">Menu</h2>

  <% if @foods.any? %>
    <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
      <% @foods.each do |food| %>
        <!-- Food Card Wrapper -->
        <div class="relative group">

          <!-- Clickable Card -->
          <div
            onclick="window.location.href='<%= vendor_food_path(@vendor, food) %>'"
            class="cursor-pointer bg-white rounded-2xl shadow-lg overflow-hidden transform transition duration-300 hover:shadow-2xl hover:-translate-y-1"
          >
            <!-- Food Image -->
            <% if food.image.attached? %>
              <%= image_tag food.image, alt: food.name, class: "w-full h-44 sm:h-48 object-cover" %>
            <% else %>
              <%= image_tag "default-promo.jpg", alt: food.name, class: "w-full h-44 sm:h-48 object-cover" %>
            <% end %>

            <!-- Food Info -->
            <div class="p-4">
              <h3 class="text-lg sm:text-xl font-bold text-red-600 mb-1 truncate"><%= food.name %></h3>
              <p class="text-gray-700 text-sm sm:text-base mb-2 truncate"><%= truncate(food.description, length: 80) %></p>
              <p class="text-red-600 font-semibold">₦<%= food.price %></p>
            </div>
          </div>

          <!-- Add to Cart Button -->
          <div class="absolute bottom-4 right-4 opacity-0 group-hover:opacity-100 transition duration-300">
            <%= form_with url: add_item_cart_path(food.id), method: :post, local: true do |f| %>
              <%= f.submit "Add to Cart",
                  class: "bg-red-600 text-white px-3 py-1 rounded-full text-sm font-semibold hover:bg-red-700 transition duration-300",
                  onclick: "event.stopPropagation()" %>
            <% end %>
          </div>

        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-center text-gray-500">No menu items available yet.</p>
  <% end %>
</section>




  <!-- =====================
       REVIEWS SECTION
  ====================== -->
  <section class="max-w-3xl mx-auto my-12 bg-white rounded-2xl shadow-lg p-6">
    <h3 class="text-2xl font-bold mb-6 text-red-600 text-center">Customer Reviews</h3>

    <% if user_signed_in? %>
      <div class="mb-6">
        <%= form_with(model: [@vendor, @vendor.vendor_reviews.build], local: true, class: "space-y-4") do |f| %>
          <div>
            <%= f.label :rating, "Your Rating", class: "block text-gray-700 font-semibold mb-1" %>
            <%= f.number_field :rating, in: 1..5, class: "border rounded px-3 py-2 w-24" %>
          </div>
          <div>
            <%= f.label :comment, "Your Review", class: "block text-gray-700 font-semibold mb-1" %>
            <%= f.text_area :comment, rows: 3, class: "border rounded px-3 py-2 w-full" %>
          </div>
          <%= f.submit "Submit Review", class: "bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition duration-300" %>
        <% end %>
      </div>
    <% else %>
      <p class="text-gray-500 text-center">
        Please <%= link_to "log in", new_user_session_path, class: "text-red-600 font-bold" %> to leave a review.
      </p>
    <% end %>

    <% @vendor.vendor_reviews.each do |review| %>
      <div class="border-b py-3">
        <p class="flex items-center space-x-2">
          <strong><%= review.user&.email || "Anonymous" %></strong>
          <span class="text-yellow-400">
            <% (review.rating || 0).times { %>★<% } %>
            <% (5 - (review.rating || 0)).times { %><span class="text-gray-300">★</span><% } %>
          </span>
        </p>
        <p class="text-gray-700 mt-1"><%= review.comment %></p>
      </div>
    <% end %>
  </section>

</main>
